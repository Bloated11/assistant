{% extends "base_.html" %}

{% block title %}Tasks - PHENOM AI{% endblock %}

{% block content %}
<h1>TASK MANAGEMENT</h1>

<div class="glass-card">
    <h2>Create New Task</h2>
    <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; margin-top: 1rem;">
        <input type="text" id="taskTitle" placeholder="Task title..." onkeypress="if(event.key==='Enter') addTask()">
        <select id="taskPriority">
            <option value="low">Low Priority</option>
            <option value="medium" selected>Medium Priority</option>
            <option value="high">High Priority</option>
        </select>
        <button onclick="addTask()" style="min-width: 120px;">
            <i class="fas fa-plus"></i> Add Task
        </button>
    </div>
</div>

<div class="glass-card">
    <h2>Active Tasks</h2>
    <div id="tasksList" style="margin-top: 1rem;"></div>
    <div id="emptyState" style="display: none; text-align: center; padding: 3rem; color: #b8d4e8;">
        No active tasks
    </div>
</div>

<script>
    async function loadTasks() {
        const res = await fetch('/tasks/api/all', { credentials: 'include' });
        const tasks = await res.json();
        const list = document.getElementById('tasksList');
        const emptyState = document.getElementById('emptyState');

        if (!tasks || tasks.length === 0) {
            list.style.display = 'none';
            emptyState.style.display = 'block';
            return;
        }

        list.style.display = 'block';
        emptyState.style.display = 'none';

        const priorityColors = {
            low: '#87CEEB',
            medium: '#87CEEB',
            high: '#87CEEB'
        };

        list.innerHTML = tasks.map(task => `
        <div style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; margin-bottom: 0.8rem; background: rgba(135, 206, 250, 0.05); border: 1px solid rgba(135, 206, 250, 0.2); border-radius: 4px; transition: all 0.3s;" 
             onmouseover="this.style.background='rgba(135, 206, 250, 0.1)'" 
             onmouseout="this.style.background='rgba(135, 206, 250, 0.05)'">
            <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                       onchange="completeTask('${task.id}')" 
                       style="width: 18px; height: 18px; cursor: pointer; accent-color: #87CEEB;">
                <div>
                    <div style="font-size: 1.05rem; margin-bottom: 0.3rem; ${task.completed ? 'text-decoration: line-through; opacity: 0.6;' : ''} color: #e0f7ff;">${task.title}</div>
                    <div style="font-size: 0.85rem; color: #b8d4e8;">
                        ${task.priority.toUpperCase()} PRIORITY
                        ${task.due_date ? ` | Due: ${task.due_date}` : ''}
                    </div>
                </div>
            </div>
            <button onclick="deleteTask('${task.id}')" 
                    style="background: rgba(135, 206, 250, 0.1); border: 1px solid rgba(135, 206, 250, 0.3); padding: 0.5rem 1rem;">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `).join('');

        const taskData = tasks.map(t => t.completed ? 0.3 : 0.7);
        if (typeof setHologramMode === 'function') {
            setHologramMode('data', taskData);
        }
    }

    async function addTask() {
        const title = document.getElementById('taskTitle').value.trim();
        const priority = document.getElementById('taskPriority').value;
        if (!title) return;

        await fetch('/tasks/api/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ title, priority })
        });

        document.getElementById('taskTitle').value = '';
        loadTasks();
    }

    async function completeTask(id) {
        await fetch('/tasks/api/complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ task_id: id })
        });
        loadTasks();
    }

    async function deleteTask(id) {
        await fetch('/tasks/api/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ task_id: id })
        });
        loadTasks();
    }

    loadTasks();
</script>
{% endblock %}